<style>
#progress-bar {
  width: 0%;
  height: 5px;
  background-color: #385898;
  transition: width 0.5s ease;
}
#progress-container {
  width: 100%;
  background-color: #ccc;
  margin-top: 10px;
  display: none;
  position: relative;
}
#progress-text {
  position: absolute;
  top: -20px;
  right: 0;
  font-size: 12px;
  color: #333;
}
.comentario {
  opacity: 0;
  transform: translateY(20px);
  transition: opacity 0.5s ease, transform 0.5s ease;
}
.comentario.aparecer {
  opacity: 1;
  transform: translateY(0);
}
</style>

<div id="progress-container">
  <div id="progress-bar"></div>
  <div id="progress-text">Cargando... 0%</div>
</div>

<script>
  setTimeout(function() {
    var botao = document.getElementById('botao');
    if (botao) {
      botao.style.display = 'flex';
      botao.style.visibility = 'visible';
      botao.style.opacity = '1';
      botao.style.position = 'relative';
      botao.style.zIndex = '9999';
      botao.style.justifyContent = 'center';
    }
  }, 370000);

  function gerarTempo() {
    const minutos = Math.floor(Math.random() * 59) + 1;
    return minutos + ' minutos';
  }

  function gerarLikes() {
    return Math.floor(Math.random() * 50) + 1;
  }

  function gerarReacao() {
    const reacoes = ['❤️', '😲'];
    return reacoes[Math.floor(Math.random() * reacoes.length)];
  }

  const comentariosFake = [...Array(30)].map((_, i) => ({
    nome: `Usuario ${i + 1}`,
    mensagem: `Comentario falso número ${i + 1}`,
    img: `https://randomuser.me/api/portraits/men/${(i % 15) + 1}.jpg`
  }));

  const listaComentarios = document.getElementById('lista-comentarios');
  const verMais = document.getElementById('ver-mais');
  const loadingComentarios = document.getElementById('loading-comentarios');
  const progressBar = document.getElementById('progress-bar');
  const progressContainer = document.getElementById('progress-container');
  const progressText = document.getElementById('progress-text');

  function piscarLoading() {
    loadingComentarios.style.opacity = loadingComentarios.style.opacity === '1' ? '0.5' : '1';
  }

  function shuffleArray(array) {
    for (let i = array.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [array[i], array[j]] = [array[j], array[i]];
    }
    return array;
  }

  let blinkInterval;

  verMais.addEventListener('click', function() {
    loadingComentarios.style.display = 'block';
    progressContainer.style.display = 'block';
    progressBar.style.width = '0%';
    progressText.innerText = 'Cargando... 0%';
    blinkInterval = setInterval(piscarLoading, 500);

    let progress = 0;
    const progressInterval = setInterval(() => {
      if (progress >= 100) {
        clearInterval(progressInterval);
      } else {
        progress += 20;
        progressBar.style.width = progress + '%';
        progressText.innerText = 'Cargando... ' + progress + '%';
      }
    }, 200);

    const comentariosEmbaralhados = shuffleArray([...comentariosFake]);
    const lote = 5;
    let carregados = 0;
    const intervalo = setInterval(() => {
      if (carregados >= comentariosFake.length) {
        clearInterval(intervalo);
        clearInterval(blinkInterval);
        verMais.style.display = 'block';
        loadingComentarios.style.display = 'none';
        progressContainer.style.display = 'none';
        return;
      }
      const subLote = shuffleArray([...comentariosFake]).slice(0, lote);
      subLote.forEach(comentario => {
        const div = document.createElement('div');
        div.classList.add('comentario');
        div.innerHTML = `<img src="${comentario.img}" alt="perfil">
          <div>
            <strong>${comentario.nome}</strong>: ${comentario.mensagem}
            <br>
            <small>
              <span style='color:#385898; cursor:pointer;'>${gerarReacao()} ${gerarLikes()}</span> - 
              <span style='color:#385898; cursor:pointer;'>Responder</span> - 
              Hace ${gerarTempo()}
            </small>
          </div>`;
        listaComentarios.appendChild(div);
        setTimeout(() => div.classList.add('aparecer'), 50);
        listaComentarios.scrollTop = listaComentarios.scrollHeight;
        carregados++;
      });
    }, 1000);
  });
</script>
